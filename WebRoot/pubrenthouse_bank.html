
<!DOCTYPE html>
<html lang="en">
<head>
<title>物管系统</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="normal/css/normal.css" type="text/css" rel="stylesheet" />
<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
<link rel="stylesheet" type="text/css" href="css/xcConfirm.css"/>
<link rel="stylesheet" href="css/uniform.css" />
<link rel="stylesheet" href="css/select2.css" />
<link rel="stylesheet" href="css/matrix-style.css" />
<link rel="stylesheet" href="css/matrix-media.css" />
<link href="font-awesome/css/font-awesome.css" rel="stylesheet" />
<script src="normal/js/jquery-1.10.2.min.js" /></script>
<script src="normal/js/normal.js" /></script>
  <script src="normal/js/common.js" /></script>
<script src="normal/js/xcConfirm.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="normal/js/menu.js"></script>
</head>
<body>
<div class="header" id="banner">
    
</div>


<div id="sidebar">

</div>
<div id="content"class="mt90">
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span6">
          <div class="widget-box">
            <div class="widget-title"> <span class="icon"> <i class="icon-align-justify"></i> </span>
              <h5>发布出租房</h5>
            </div>
            <div class="widget-content nopadding">
              <form action="/manage/fileUpload" method="post" class="form-horizontal" enctype="multipart/form-data" id="form">
               <div class="control-group">
                  <label class="control-label">标题</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入标题" id="Name1" rule="name:'标题', notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">小区名字</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入小区名字" id="residName" rule="name:'小区名字', notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">楼层</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入楼层" id="cellNum" rule="name:'楼层', number:true, notnull:true">
                  </div>
                </div>
               <div class="control-group">
                  <label class="control-label">厅室</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入几厅几室" id="hall" rule="name:'厅室', notnull:true">
                  </div>
                </div>
                  <div class="control-group">
                  <label class="control-label">面积(㎡)</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入面积" id="field1" rule="name:'面积', amount:true, notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">单价(元/月)</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入单价" id="Price" rule="name:'单价', amount:true, notnull:true">
                  </div>
                </div>
                 <div class="control-group">
                  <label class="control-label">朝向</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入朝向" id="direction" rule="name:'朝向', notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">产权(年)</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入房屋产权" id="property" rule="name:'产权', number:true, notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">修建年代(年代)</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入修建年代" id="buildYear" rule="name:'修建年代', number:true, notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">装修</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入装修规格" id="renovation" rule="name:'装修', notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">地址</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入地址" id="address" rule="name:'地址', notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">联系人</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入联系人姓名" id="contactPerson" rule="name:'联系人', notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">联系电话</label>
                  <div class="controls">
                    <input type="text" class="span11 validate" placeholder="请输入联系电话" id="contactPhone" rule="name:'联系电话', mobile:true, notnull:true">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label">上传图片</label>
                  <div class="controls">
                      <input name="file1" id="file1" type="file" size="19" style="opacity: 0;"/>
                  </div>
                   <div class="controls">
                      <input name="file2" id="file2" type="file" size="19" style="opacity: 0;"/>
                  </div>
                   <div class="controls">
                      <input name="file3" id="file3" type="file" size="19" style="opacity: 0;"/>
                  </div>
                   <div class="controls">
                      <input name="file4" id="file4" type="file" size="19" style="opacity: 0;"/>
                  </div>
                   <div class="controls">
                      <input name="file5" id="file5" type="file" size="19" style="opacity: 0;"/>
                  </div>
               </div>
                <div class="form-actions">
                  <button type="button" class="btn btn-success" onclick="upladFile()">发布信息</button>
                </div>
              </form>
            </div>
          </div>
        </div>
    </div>

  </div>
</div>
<!--Footer-part-->
<div class="row-fluid">
  <div id="footer" class="span12">
  服务热线：028-25855545<br/>
  Copyright © 2014 XXXX 版权所有
  </div>
</div>
<!--end-Footer-part-->
<script src="js/jquery.min.js"></script> 
<script src="js/jquery.ui.custom.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="js/jquery.uniform.js"></script> 
<script src="js/select2.min.js"></script> 
<script src="js/jquery.dataTables.min.js"></script> 
<script src="js/matrix.js"></script> 
<script src="js/matrix.tables.js"></script>
<script>
var url = '';

function addWares(){
	//获取表单数据
  	var hall = $("#hall").val();  // 厅室
	var residName = $("#residName").val();  // 小区名字
	var cellNum = $("#cellNum").val();  // 楼层
	var direction = $("#direction").val();  //朝向
	var property = $("#property").val();  //产权
	var buildYear = $("#buildYear").val();  //修建年代
	var renovation = $("#renovation").val();  //装修
	var address = $("#address").val();  //地址
	var contactPerson = $("#contactPerson").val();  //联系人
	var contactPhone = $("#contactPhone").val(); //联系电话
	var field1 = $("#field1").val(); //面积
	
	var Price = $("#Price").val();//单价
	var Name1 = $("#Name1").val()//标题
	var Unit = "元/月"; //计量单位
	var description1 = "";//描述
	var Type1 = "3";
	var Type2 = "2";
	
	var waresId=App.util.getUrlParam('waresId');
	if(waresId==null ||waresId==''|| waresId==undefined){
		App.util.executeCmdSys("/wares/addWares.action", {
			sellerId:currentUser.userId,
	  		//单价
	  	  	Price:Price,
	  	  	Unit:Unit,
	  	  	//标题
	  	  	Name1:Name1,
	  	  	Images:url,
	  	  	//描述
	  	  	description1:description1,
	  	  	Type1:Type1,
	  	  	Type2:Type2
	  		},"post").success(function(result) {
	  			if(result.code=='succ001'){
					App.util.executeCmdSys("/user/addHouseInfo.action", {
		  				waresId: result.waresId,
		  				hall:hall,  // 厅室
		  				residName:residName,  // 小区名字
		  				cellNum:cellNum,  // 楼层
		  				direction:direction,  //朝向
		  				property:property,  //产权
		  				buildYear:buildYear,  //修建年代
		  				renovation:renovation,  //装修
		  				address:address,  //地址
		  				contactPerson:contactPerson,  //联系人
		  				contactPhone:contactPhone, //联系电话
		  				field1:field1//面积
		  				},"post").success(function(res) {
		  					if(res.code=='succ001'){
		  						window.wxc.xcConfirm("出租房发布成功", window.wxc.xcConfirm.typeEnum.success,{onOk:function(){location.reload(true);}});
		  						
		  					}else{
		  						window.wxc.xcConfirm("出租房发布失败", window.wxc.xcConfirm.typeEnum.error);
		  					}
		  				});
  			}else{
  				window.wxc.xcConfirm("出租房发布失败", window.wxc.xcConfirm.typeEnum.error);
  			}
  		}); 
	  }else{
		  //修改操作
	  }
}
function upladFile() {
	if(App.util.validate($("#form"))){
		//上传文件
		var urlJson={};
		
	    var fileObj1 = document.getElementById("file1").files[0]; // 获取文件对象
	    var fileObj2 = document.getElementById("file2").files[0]; // 获取文件对象
	    var fileObj3 = document.getElementById("file3").files[0]; // 获取文件对象
	    var fileObj4 = document.getElementById("file4").files[0]; // 获取文件对象
	    var fileObj5 = document.getElementById("file5").files[0]; // 获取文件对象
	    var FileController = "/manage/fileUpload";                    // 接收上传文件的后台地址 
	    // FormData 对象
	    var form = new FormData();
	    form.append("file1", fileObj1);                           // 文件对象
	    form.append("file2", fileObj2);                           // 文件对象
	    form.append("file3", fileObj3);                           // 文件对象
	    form.append("file4", fileObj4);                           // 文件对象
	    form.append("file5", fileObj5);                           // 文件对象
	    // XMLHttpRequest 对象
	    var xhr = new XMLHttpRequest();
	    xhr.open("post", FileController, false);
	    xhr.onreadystatechange = function(){
	    	if (xhr.readyState==4){
	    		if (xhr.status==200){  
	    			var result = xhr.responseText;  
	    			if(result == "false"){
	    				window.wxc.xcConfirm("网络连接超时，请检查网络情况！", window.wxc.xcConfirm.typeEnum.error);
	    				location.reload(true);
	    				return;
	    			}
	    			urlJson = eval("(" + result + ")");
	    			for(var i=0;i<urlJson.length;i++){
	    		    	if(urlJson[i].status != "4"){
	    		    		window.wxc.xcConfirm(urlJson[i].statusdesc, window.wxc.xcConfirm.typeEnum.error);
	    		    		location.reload(true);
	    		    	}else{
	    		    		url += urlJson[i].url + ",";
	    		    	}
	    		    }
	    			if(url){
	    				url = url.substring(0,url.length-1);
	    			}
	    			addWares();
	            }  
	    		xhr = null;
	        }else{
	        	window.wxc.xcConfirm("图片上传失败，请刷新页面重试!", window.wxc.xcConfirm.typeEnum.error);
	        	location.reload(true);
	        }  
	    }  
	    xhr.send(form);
	}
}

$(function(){
	//加载横幅菜单
	banner();
	//加载权限菜单
	rightMenu(13);
	
  $('.filename').text("没有选中");
  $('.action').text("点击上传");
})
</script>
</body>
</html>
